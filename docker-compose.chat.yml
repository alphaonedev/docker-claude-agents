###############################################################################
# Docker Claude Agents — Interactive Chat Mode
#
# Runs a single Claude agent for ad-hoc tasks and interactive sessions.
#
# Usage:
#   docker compose -f docker-compose.chat.yml run --rm claude-chat
#   docker compose -f docker-compose.chat.yml run --rm claude-chat \
#     --dangerously-skip-permissions "Refactor this codebase"
###############################################################################

services:
  claude-chat:
    build:
      context: .
      dockerfile: Dockerfile.base
      args:
        CLAUDE_CODE_VERSION: ${CLAUDE_CODE_VERSION:-latest}
    stdin_open: true
    tty: true
    environment:
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:?ANTHROPIC_API_KEY is required — see .env.example}
      CLAUDE_AGENT_ROLE: chat
    volumes:
      - ./.claude:/home/node/.claude
      - ./workspace:/app
    networks:
      - agent-net
    restart: "no"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: 4G
    entrypoint: ["claude"]
    command: ["--dangerously-skip-permissions"]

networks:
  agent-net:
    driver: bridge
